(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/settle/settle"],{"4e98":function(e,t,a){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){return a.e("components/uni-swipe-action/uni-swipe-action").then(a.bind(null,"4dfd"))},r=new Date,n=r.getFullYear(),l=r.getMonth()+1;l<10&&(l="0"+l);var o=r.getDate();o<10&&(o="0"+o);var c=n+"."+l+"."+o;console.log(e(c," at pages\\settle\\settle.vue:82"));var u=n+"-"+l+"-"+o,h=u.replace(/-/g,"/"),d=new Date(Date.parse(h)),p={components:{uniSwipeAction:i},data:function(){return{fanhuiIcon:this.httpUrl+"file/static/order/jiehznag-icon-fanhui.png",telvalue:"",cardshow:1,cardIndex:null,username:"",assisant:"",userNo:"",userDes:"",shop_pkid:"",order_code:"",totalPrice:"",totalPrices:0,zkdate:"",recharge_type:"",balance:"",cardid:"",zkname:"",cardnames:"",number_of_use:"",jzType:"",Ischeck:null,styleNum:0,maturitytime:"",imgCards:[],checkedIcon:this.httpUrl+"file/static/settle/jiezhang-icon-anniu-sel@3x.png",selIconState:this.httpUrl+"file/static/settle/jiezhang-icon-anniu-nor@3x.png",settleArray:[{styleIcon:this.httpUrl+"file/static/settle/jiezhang-icon-wxzf@3x.png",styleTitle:"微信支付"},{styleIcon:this.httpUrl+"file/static/settle/jiezhang-icon-zfbzf@3x.png",styleTitle:"支付宝支付"},{styleIcon:this.httpUrl+"file/static/settle/jiezhang-icon-xjzf@3x.png",styleTitle:"现金支付"}],balanceTotal:0}},onLoad:function(t){console.log(e(t," at pages\\settle\\settle.vue:138"));var a=this;a.assisant=t.assisant,a.username=t.username,a.userNo=t.order_code,a.userDes=t.userDes,a.shop_pkid=t.shop_pkid,a.order_code=t.order_code,a.totalPrice=t.totalPrice,a.telvalue=t.telphone;var i=t.jzType;a.jzType=t.jzType,"散客结账"==i?a.cardshow=0:s.request({url:a.httpUrl+"Jni_Member_CardController/selectCard.xsh?shop_pkid="+a.shop_pkid+"&tel="+a.telvalue,method:"GET",data:{},success:function(t){console.log(e("获取手机号",t," at pages\\settle\\settle.vue:160")),a.orderlists=[];var s=t.data.obj;for(var i in a.imgCards=[],s){var r="",n=s[i].card_name,l=s[i].mctd_img;if("次数卡"==s[i].mct_name)r=s[i].number_of_use+"次",n+="次数卡";else if("时效卡"==s[i].mct_name){r="",n=s[i].created_date,n=n.replace(new RegExp("/","g"),"."),n=n.replace(new RegExp("-","g"),".");var o=s[i].maturity_time;o=o.replace(new RegExp("/","g"),"."),o=o.replace(new RegExp("-","g"),"."),n="有效期"+n+"-"+o;var c=s[i].maturity_time,u=c.replace(/-/g,"/"),h=new Date(Date.parse(u));Number(d)>Number(h)&&(l=this.httpUrl+"file/static/jiantouka_tupian/outdate@2x.png")}else if("打折卡"==s[i].mct_name){var p=s[i].maturity_time;r=p+"到期",n=n;var _=p.replace(/-/g,"/"),m=new Date(Date.parse(_));Number(d)>Number(m)&&(l=this.httpUrl+"file/static/jiantouka_tupian/outdate@2x.png")}else r=s[i].balance+"元";a.imgCards.push({path:l,title:s[i].mct_name,card_name:s[i].card_name,discount:s[i].mctd_discount,balance:s[i].balance,cardid:s[i].mc_pkid,cardids:s[i].card_id,number_of_use:s[i].number_of_use,maturity_time:s[i].maturity_time,remark3:n,desnow:r})}},fail:function(t){console.log(e("响应失败",t," at pages\\settle\\settle.vue:224"))}})},methods:{back:function(){s.navigateBack({delta:1})},newOrder:function(){var t=this,a=t.maturitytime,i=a.replace(/-/g,"/"),r=new Date(Date.parse(i)),n=t.zkdate,l=n.replace(/-/g,"/"),o=new Date(Date.parse(l));if(""!==t.recharge_type){if(Number(t.balanceTotal)<Number(t.totalPrices)&&"储蓄卡"==t.zkname)return s.showToast({title:"卡余额不足,请选择其他方式支付",icon:"none"}),!1;if(Number(d)>Number(r)&&"时效卡"==t.zkname)return s.showToast({title:"时效卡已过期,请选择其他方式支付",icon:"none"}),!1;if(Number(d)>Number(o)&&"打折卡"==t.zkname&&""!==t.recharge_type)return s.showToast({title:"该打折卡已过期,请选择其他方式支付",icon:"none"}),!1;if(Number(d)<=Number(o)&&"打折卡"==t.zkname&&""!==t.recharge_type)return t.recharge_type=t.cardnames+","+t.recharge_type,!1;if("次数卡"==t.zkname&&0==Number(t.number_of_use))return s.showToast({title:"卡剩余次数不足,请选择其他方式支付",icon:"none"}),!1;s.showToast({title:"加载中...",icon:"loading"}),s.request({url:t.httpUrl+"Jni_Consumption_RecordController/add_sanhu.xsh",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{created_by:t.username,created_assist:t.assisant,cr_money:t.totalPrices,recharge_type:t.recharge_type,shop_pkid:t.shop_pkid,order_code:t.order_code},success:function(t){console.log(e("结账成功",t," at pages\\settle\\settle.vue:299"))},fail:function(t){console.log(e(t," at pages\\settle\\settle.vue:302"))}}),"散客结账"!==t.jzType&&s.request({url:t.httpUrl+"Jni_Member_CardController/updateCard.xsh",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{created_by:t.username,created_assist:t.assisant,cr_money:t.totalPrices,recharge_type:t.recharge_type,shop_pkid:t.shop_pkid,order_code:t.order_code,balance:t.balance,mc_pkid:t.cardid,number_of_use:t.number_of_use},success:function(t){console.log(e("更新结账成功111",t," at pages\\settle\\settle.vue:324"))},fail:function(t){console.log(e(t," at pages\\settle\\settle.vue:327"))}});var u=t.balance;"次数卡支付"==t.recharge_type&&(u=t.number_of_use),setTimeout(function(){s.navigateTo({url:"../settleSuccess/settleSuccess?order_code="+t.order_code+"&recharge_type="+t.recharge_type+"&dateRes="+c+"&balance="+u+"&shop_pkid="+t.shop_pkid})},2e3)}else""==t.recharge_type&&"打折卡"==t.zkname?s.showToast({title:"请选择折扣方式支付",icon:"none"}):s.showToast({title:"请选择好付款方式...",icon:"none"})},sel:function(t){console.log(e("支付方式："+this.settleArray[t].styleTitle," at pages\\settle\\settle.vue:355")),this.recharge_type=this.settleArray[t].styleTitle,"打折卡"!==this.zkname&&(this.cardIndex=null,this.balance="",this.cardnames=""),this.Ischeck=t,this.totalPrices=this.totalPrice,console.log(e(this.totalPrices," at pages\\settle\\settle.vue:372"))},cardcheck:function(t,a){console.log(e("卡片",t," at pages\\settle\\settle.vue:376")),this.recharge_type=t.title+"支付",this.cardnames="",this.maturitytime="",this.zkdate="",this.zkname=t.title,"次数卡"==t.title?(console.log(e("次数卡前",t.number_of_use," at pages\\settle\\settle.vue:384")),this.number_of_use=t.number_of_use-1,console.log(e("次数卡",this.number_of_use," at pages\\settle\\settle.vue:386")),this.totalPrices=this.totalPrice,this.balanceTotal=this.totalPrices,this.balance=parseFloat(t.balance),console.log(e(this.totalPrices,this.recharge_type,this.balance,this.cardid," at pages\\settle\\settle.vue:390"))):"时效卡"==t.title?(this.number_of_use=t.number_of_use,console.log(e("时效卡",this.number_of_use," at pages\\settle\\settle.vue:393")),this.maturitytime=t.maturity_time,this.totalPrices=this.totalPrice,this.balanceTotal=this.totalPrices,this.balance=parseFloat(t.balance),console.log(e(this.totalPrices,this.recharge_type,this.balance,this.cardid,this.maturitytime," at pages\\settle\\settle.vue:398"))):"打折卡"==t.title?(this.number_of_use=t.number_of_use,this.totalPrices=this.totalPrice*t.discount,this.totalPrices=this.totalPrices.toFixed(2),this.balanceTotal=parseFloat(t.balance),this.balance=parseFloat(t.balance),this.zkdate=t.maturity_time,this.recharge_type="",this.cardnames=t.card_name,console.log(e(this.totalPrices,this.recharge_type,this.balance,this.cardid,this.zkdate,this.zkname," at pages\\settle\\settle.vue:409"))):0==t.discount?(this.number_of_use=t.number_of_use,this.totalPrices=this.totalPrice,this.balance=parseFloat(t.balance)-this.totalPrices,this.balance=this.balance.toFixed(2),this.balanceTotal=this.balance,console.log(e(this.totalPrices,this.recharge_type,this.balance,this.cardid," at pages\\settle\\settle.vue:416"))):(this.number_of_use=t.number_of_use,this.totalPrices=this.totalPrice*t.discount,this.totalPrices=this.totalPrices.toFixed(2),this.balance=parseFloat(t.balance)-this.totalPrices,this.balanceTotal=this.balance,console.log(e(this.totalPrices,this.recharge_type,this.balance,this.cardid," at pages\\settle\\settle.vue:423"))),this.cardid=t.cardid,this.cardIndex=a,this.Ischeck=null}}};t.default=p}).call(this,a("0de9")["default"],a("6e42")["default"])},"600f":function(e,t,a){"use strict";a.r(t);var s=a("9969"),i=a("ecba");for(var r in i)"default"!==r&&function(e){a.d(t,e,function(){return i[e]})}(r);a("ebd9");var n=a("2877"),l=Object(n["a"])(i["default"],s["a"],s["b"],!1,null,null,null);t["default"]=l.exports},9969:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c},i=[];a.d(t,"a",function(){return s}),a.d(t,"b",function(){return i})},ebd9:function(e,t,a){"use strict";var s=a("ffeb"),i=a.n(s);i.a},ecba:function(e,t,a){"use strict";a.r(t);var s=a("4e98"),i=a.n(s);for(var r in s)"default"!==r&&function(e){a.d(t,e,function(){return s[e]})}(r);t["default"]=i.a},ffeb:function(e,t,a){}},[["8ccc","common/runtime","common/vendor"]]]);