(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/settle/settle"],{"600f":function(e,t,a){"use strict";a.r(t);var s=a("b709"),i=a("ecba");for(var r in i)"default"!==r&&function(e){a.d(t,e,function(){return i[e]})}(r);a("ebd9");var c=a("2877"),n=Object(c["a"])(i["default"],s["a"],s["b"],!1,null,null,null);t["default"]=n.exports},"85a8":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(a("4dfd"));function i(e){return e&&e.__esModule?e:{default:e}}var r=new Date,c=r.getFullYear(),n=r.getMonth()+1;n<10&&(n="0"+n);var l=r.getDate();l<10&&(l="0"+l);var o=c+"."+n+"."+l;console.log(o);var u=c+"-"+n+"-"+l,d=u.replace(/-/g,"/"),h=new Date(Date.parse(d)),_={components:{uniSwipeAction:s.default},data:function(){return{telvalue:"",cardshow:1,cardIndex:null,username:"",assisant:"",userNo:"",userDes:"",shop_pkid:"",order_code:"",totalPrice:"",totalPrices:0,zkdate:"",recharge_type:"",balance:"",cardid:"",zkname:"",cardnames:"",number_of_use:"",jzType:"",Ischeck:null,styleNum:0,maturitytime:"",imgCards:[],checkedIcon:"../../static/settle/jiezhang-icon-anniu-sel@3x.png",selIconState:"../../static/settle/jiezhang-icon-anniu-nor@3x.png",settleArray:[{styleIcon:"../../static/settle/jiezhang-icon-wxzf@3x.png",styleTitle:"微信支付"},{styleIcon:"../../static/settle/jiezhang-icon-zfbzf@3x.png",styleTitle:"支付宝支付"},{styleIcon:"../../static/settle/jiezhang-icon-xjzf@3x.png",styleTitle:"现金支付"}],balanceTotal:0}},onLoad:function(t){console.log(t);var a=this;a.assisant=t.assisant,a.username=t.username,a.userNo=t.order_code,a.userDes=t.userDes,a.shop_pkid=t.shop_pkid,a.order_code=t.order_code,a.totalPrice=t.totalPrice,a.telvalue=t.telphone;var s=t.jzType;a.jzType=t.jzType,"散客结账"==s?a.cardshow=0:e.request({url:a.httpUrl+"Jni_Member_CardController/selectCard.xsh?shop_pkid="+a.shop_pkid+"&tel="+a.telvalue,method:"GET",data:{},success:function(e){console.log("获取手机号",e),a.orderlists=[];var t=e.data.obj;for(var s in a.imgCards=[],t){var i="",r=t[s].card_name,c=t[s].mctd_img;if("次数卡"==t[s].mct_name)i=t[s].number_of_use+"次",r+="次数卡";else if("时效卡"==t[s].mct_name){i="",r=t[s].created_date,r=r.replace(new RegExp("/","g"),"."),r=r.replace(new RegExp("-","g"),".");var n=t[s].maturity_time;n=n.replace(new RegExp("/","g"),"."),n=n.replace(new RegExp("-","g"),"."),r="有效期"+r+"-"+n;var l=t[s].maturity_time,o=l.replace(/-/g,"/"),u=new Date(Date.parse(o));Number(h)>Number(u)&&(c="../../static/jiantouka_tupian/outdate@2x.png")}else if("打折卡"==t[s].mct_name){var d=t[s].maturity_time;i=d+"到期",r=r;var _=d.replace(/-/g,"/"),m=new Date(Date.parse(_));Number(h)>Number(m)&&(c="../../static/jiantouka_tupian/outdate@2x.png")}else i=t[s].balance+"元";a.imgCards.push({path:c,title:t[s].mct_name,card_name:t[s].card_name,discount:t[s].mctd_discount,balance:t[s].balance,cardid:t[s].mc_pkid,cardids:t[s].card_id,number_of_use:t[s].number_of_use,maturity_time:t[s].maturity_time,remark3:r,desnow:i})}},fail:function(e){console.log("响应失败",e)}})},methods:{back:function(){e.navigateBack({delta:1})},newOrder:function(){var t=this,a=t.maturitytime,s=a.replace(/-/g,"/"),i=new Date(Date.parse(s)),r=t.zkdate,c=r.replace(/-/g,"/"),n=new Date(Date.parse(c));if(""!==t.recharge_type){if(Number(t.balanceTotal)<Number(t.totalPrices)&&"储蓄卡"==t.zkname)return e.showToast({title:"卡余额不足,请选择其他方式支付",icon:"none"}),!1;if(Number(h)>Number(i)&&"时效卡"==t.zkname)return e.showToast({title:"时效卡已过期,请选择其他方式支付",icon:"none"}),!1;if(Number(h)>Number(n)&&"打折卡"==t.zkname&&""!==t.recharge_type)return e.showToast({title:"该打折卡已过期,请选择其他方式支付",icon:"none"}),!1;if(Number(h)<=Number(n)&&"打折卡"==t.zkname&&""!==t.recharge_type)return t.recharge_type=t.cardnames+","+t.recharge_type,!1;if("次数卡"==t.zkname&&0==Number(t.number_of_use))return e.showToast({title:"卡剩余次数不足,请选择其他方式支付",icon:"none"}),!1;e.showToast({title:"加载中...",icon:"loading"}),e.request({url:t.httpUrl+"Jni_Consumption_RecordController/add_sanhu.xsh",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{created_by:t.username,created_assist:t.assisant,cr_money:t.totalPrices,recharge_type:t.recharge_type,shop_pkid:t.shop_pkid,order_code:t.order_code},success:function(e){console.log("结账成功",e)},fail:function(e){console.log(e)}}),"散客结账"!==t.jzType&&e.request({url:t.httpUrl+"Jni_Member_CardController/updateCard.xsh",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{created_by:t.username,created_assist:t.assisant,cr_money:t.totalPrices,recharge_type:t.recharge_type,shop_pkid:t.shop_pkid,order_code:t.order_code,balance:t.balance,mc_pkid:t.cardid,number_of_use:t.number_of_use},success:function(e){console.log("更新结账成功111",e)},fail:function(e){console.log(e)}});var l=t.balance;"次数卡支付"==t.recharge_type&&(l=t.number_of_use),setTimeout(function(){e.navigateTo({url:"../settleSuccess/settleSuccess?order_code="+t.order_code+"&recharge_type="+t.recharge_type+"&dateRes="+o+"&balance="+l+"&shop_pkid="+t.shop_pkid})},2e3)}else""==t.recharge_type&&"打折卡"==t.zkname?e.showToast({title:"请选择折扣方式支付",icon:"none"}):e.showToast({title:"请选择好付款方式...",icon:"none"})},sel:function(e){console.log("支付方式："+this.settleArray[e].styleTitle),this.recharge_type=this.settleArray[e].styleTitle,"打折卡"!==this.zkname&&(this.cardIndex=null,this.balance="",this.cardnames=""),this.Ischeck=e,this.totalPrices=this.totalPrice,console.log(this.totalPrices)},cardcheck:function(e,t){console.log("卡片",e),this.recharge_type=e.title+"支付",this.cardnames="",this.maturitytime="",this.zkdate="",this.zkname=e.title,"次数卡"==e.title?(console.log("次数卡前",e.number_of_use),this.number_of_use=e.number_of_use-1,console.log("次数卡",this.number_of_use),this.totalPrices=this.totalPrice,this.balanceTotal=this.totalPrices,this.balance=parseFloat(e.balance),console.log(this.totalPrices,this.recharge_type,this.balance,this.cardid)):"时效卡"==e.title?(this.number_of_use=e.number_of_use,console.log("时效卡",this.number_of_use),this.maturitytime=e.maturity_time,this.totalPrices=this.totalPrice,this.balanceTotal=this.totalPrices,this.balance=parseFloat(e.balance),console.log(this.totalPrices,this.recharge_type,this.balance,this.cardid,this.maturitytime)):"打折卡"==e.title?(this.number_of_use=e.number_of_use,this.totalPrices=this.totalPrice*e.discount,this.totalPrices=this.totalPrices.toFixed(2),this.balanceTotal=parseFloat(e.balance),this.balance=parseFloat(e.balance),this.zkdate=e.maturity_time,this.recharge_type="",this.cardnames=e.card_name,console.log(this.totalPrices,this.recharge_type,this.balance,this.cardid,this.zkdate,this.zkname)):0==e.discount?(this.number_of_use=e.number_of_use,this.totalPrices=this.totalPrice,this.balance=parseFloat(e.balance)-this.totalPrices,this.balance=this.balance.toFixed(2),this.balanceTotal=this.balance,console.log(this.totalPrices,this.recharge_type,this.balance,this.cardid)):(this.number_of_use=e.number_of_use,this.totalPrices=this.totalPrice*e.discount,this.totalPrices=this.totalPrices.toFixed(2),this.balance=parseFloat(e.balance)-this.totalPrices,this.balanceTotal=this.balance,console.log(this.totalPrices,this.recharge_type,this.balance,this.cardid)),this.cardid=e.cardid,this.cardIndex=t,this.Ischeck=null}}};t.default=_}).call(this,a("543d")["default"])},"8ccc":function(e,t,a){"use strict";a("d3e6");var s=r(a("b0ce")),i=r(a("600f"));function r(e){return e&&e.__esModule?e:{default:e}}Page((0,s.default)(i.default))},b709:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("view",{staticClass:"bg"},[a("view",{staticClass:"nav"},[a("view",{staticClass:"nav-list",attrs:{eventid:"5cba616a-0"},on:{click:e.back}},[a("image",{staticClass:"backicon",attrs:{src:"../../static/order/jiehznag-icon-fanhui.png",mode:""}})]),a("view",{staticClass:"nav-list",attrs:{id:"life0"}},[e._v("0卡生活")]),a("view",{staticClass:"nav-list"})]),a("view",[a("view",{staticClass:" contentlist"},[a("view",{staticClass:"orderlist"},[a("view",{staticClass:"olistleft"}),a("view",{staticClass:"olist"},[a("view",[e._v(e._s(e.username))]),a("view",[e._v(e._s(e.userNo))]),a("view",[e._v(e._s(e.userDes))])]),a("view",{staticClass:"olistleft"})])]),a("view",{staticClass:"order"},[a("view",{staticClass:"card-menu",style:{opacity:e.cardshow}},e._l(e.imgCards,function(t,s){return a("scroll-view",{key:s,staticClass:"scrollview",attrs:{"scroll-x":"true","scroll-left":"0",eventid:"5cba616a-1-"+s},on:{scroll:e.scroll,click:function(a){e.cardcheck(t,s)}}},[a("image",{staticClass:"imgborder",class:{MenuCurrent:e.cardIndex===s},attrs:{src:t.path}},[a("view",{staticClass:"card"},[a("view",{staticClass:"cardtop"},[a("view",{staticClass:"cardVip"},[e._v("VIP")]),a("view",{staticClass:"cardTypeC"},[e._v(e._s(t.title))])]),a("view",{staticClass:"noCard"},[e._v("NO."+e._s(t.cardids))]),a("view",{staticClass:"moneny"},[a("view",{staticClass:"moneny1"},[e._v(e._s(t.remark3))]),a("view",{staticClass:"moneny2"},[e._v(e._s(t.desnow))])])])])])})),a("view",{staticClass:"settleStyle"},[e._m(0),a("view",{staticClass:"sel"},e._l(e.settleArray,function(t,s){return a("view",{key:s,staticClass:"sellist",attrs:{eventid:"5cba616a-2-"+s},on:{click:function(t){e.sel(s)}}},[a("label",[a("image",{staticClass:"selStyle",attrs:{src:t.styleIcon,mode:""}}),e._v(e._s(t.styleTitle))]),a("label",[a("image",{staticClass:"selState",attrs:{src:e.Ischeck===s?e.checkedIcon:e.selIconState,mode:""}})])],1)}))])])]),a("view",{staticClass:"foot",attrs:{eventid:"5cba616a-3"},on:{click:e.newOrder}},[a("button",{staticClass:"btn"},[e._v("结账")])],1)])},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("view",{staticClass:"title"},[a("view",{staticClass:"titleline"}),e._v("抵扣支付方式")])}];a.d(t,"a",function(){return s}),a.d(t,"b",function(){return i})},ebd9:function(e,t,a){"use strict";var s=a("ffeb"),i=a.n(s);i.a},ecba:function(e,t,a){"use strict";a.r(t);var s=a("85a8"),i=a.n(s);for(var r in s)"default"!==r&&function(e){a.d(t,e,function(){return s[e]})}(r);t["default"]=i.a},ffeb:function(e,t,a){}},[["8ccc","common/runtime","common/vendor"]]]);